<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitação de Parceria</title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Impede que o scroll cause loop infinito */
            height: auto;
            min-height: 100vh;
        }
    </style>
</head>
<body>

<div id="app-container" style="padding-bottom: 20px;">
    <div id="progress-container">
        <div id="progress-bg">
            <div id="progress-bar"></div>
        </div>
    </div>

    <form id="partner-form" onsubmit="return false;">
        
        <div class="step" data-step="1">
            <h2>Qual é o seu nome completo?</h2>
            <div class="input-group">
                <input type="text" id="name" placeholder="Digite seu nome completo">
                <div class="error-msg">Este campo é obrigatório</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="2">
            <h2>Qual é o seu e-mail?</h2>
            <div class="input-group">
                <input type="email" id="email" placeholder="exemplo@email.com">
                <div class="error-msg">Informe um e-mail válido</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="3">
            <h2>Seu Telefone / WhatsApp</h2>
            <div class="input-group">
                <input type="tel" id="phone" placeholder="(XX) XXXXX-XXXX">
                <div class="error-msg">Informe um telefone válido (apenas números)</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="4">
            <h2>De onde você é? (Cidade/UF)</h2>
            <div class="input-group" style="position: relative;">
                <input type="text" id="city-input" placeholder="Digite sua cidade..." autocomplete="off">
                <div id="city-suggestions" class="autocomplete-list"></div>
                <div class="error-msg">Selecione uma cidade válida da lista</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="5">
            <h2>Qual seu perfil no Instagram?</h2>
            <div class="input-group">
                <input type="text" id="instagram" placeholder="@seuusuario">
                <div class="error-msg">Este campo é obrigatório</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="6">
            <h2>Que tipo de parceria você busca?</h2>
            <div class="sub-label">Selecione todas as opções aplicáveis</div>
            <div class="checkbox-group" id="partnership-type-group">
                <label><input type="checkbox" value="Conteúdos para redes sociais"> Conteúdos para redes sociais</label>
                <label><input type="checkbox" value="Cursos, treinamentos e/ou Hands-on" id="chk-cursos"> Cursos, treinamentos e/ou Hands-on</label>
                <div class="error-msg">Selecione pelo menos uma opção</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="7">
            <h2>Quais marcas você utiliza atualmente?</h2>
            <div class="checkbox-group" id="brands-group">
                <label><input type="checkbox" value="Tokuyama" class="brand-opt"> Tokuyama</label>
                <label><input type="checkbox" value="Potenza" class="brand-opt"> Potenza</label>
                <label><input type="checkbox" value="Nic Tone" class="brand-opt"> Nic Tone</label>
                <label><input type="checkbox" value="Ainda não utilizei" id="chk-brand-none"> Ainda não utilizei, será meu primeiro contato...</label>
                <div class="error-msg">Selecione uma opção</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="8">
            <h2>Quais produtos você conhece/utiliza?</h2>
            <div class="sub-label">Pesquise e clique para adicionar</div>
            <div id="products-tag-input-wrapper">
                </div>
            <div class="error-msg" id="err-p8">Selecione pelo menos um produto</div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="9">
            <h2>Por que ainda não testou Potenza?</h2>
            <div class="radio-group" id="potenza-reason-group">
                <label><input type="radio" name="potenza_reason" value="Sem oportunidade"> Sem oportunidade</label>
                <label><input type="radio" name="potenza_reason" value="Outras marcas"> Outras marcas</label>
                <label><input type="radio" name="potenza_reason" value="Não adaptei"> Não adaptei</label>
                <label><input type="radio" name="potenza_reason" value="Outro" id="radio-potenza-other"> Outro</label>
            </div>
            <input type="text" id="potenza-reason-other" placeholder="Qual motivo?" class="hidden" style="margin-top:10px;">
            <div class="error-msg">Selecione uma opção</div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="10">
            <h2>Tem interesse em testar algum produto Potenza?</h2>
            <div class="radio-group" id="potenza-interest-bool">
                <label><input type="radio" name="potenza_interest" value="Sim" id="radio-interest-sim"> Sim</label>
                <label><input type="radio" name="potenza_interest" value="Não"> Não</label>
            </div>
            <div id="potenza-interest-tags" class="hidden" style="margin-top:15px;">
                <label>Quais produtos?</label>
                <div id="potenza-interest-wrapper">
                    </div>
            </div>
            <div class="error-msg">Preencha este campo</div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="11">
            <h2>Possui parcerias ativas?</h2>
            <div class="sub-label">Preencha os nomes ou marque Nenhuma</div>
            <div class="checkbox-group" id="active-partnerships-group">
                <label style="flex-direction: column; align-items: flex-start;">
                    <div style="display:flex; align-items:center;">
                        <input type="checkbox" id="chk-dentais"> Dentais
                    </div>
                    <input type="text" id="input-dentais" placeholder="Quais dentais?" class="hidden" style="margin-top:5px; width:100%;">
                </label>
                <label style="flex-direction: column; align-items: flex-start;">
                    <div style="display:flex; align-items:center;">
                        <input type="checkbox" id="chk-empresas"> Empresas
                    </div>
                    <input type="text" id="input-empresas" placeholder="Quais empresas?" class="hidden" style="margin-top:5px; width:100%;">
                </label>
                <label><input type="checkbox" id="chk-no-partners"> Nenhuma</label>
                <div class="error-msg">Selecione uma opção válida</div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="12">
            <h2>Existe contrato de exclusividade?</h2>
            <div class="radio-group" id="exclusivity-group">
                <label style="flex-direction: column; align-items: flex-start;">
                    <div style="display:flex; align-items:center;">
                        <input type="radio" name="exclusivity" value="Sim" id="radio-excl-sim"> Sim
                    </div>
                    <input type="text" id="input-exclusivity" placeholder="Detalhes da exclusividade" class="hidden" style="margin-top:5px; width:100%;">
                </label>
                <label><input type="radio" name="exclusivity" value="Não"> Não</label>
            </div>
            <div class="error-msg">Preencha este campo</div>
            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-next">Próximo</button>
            </div>
        </div>

        <div class="step hidden" data-step="13">
            <h2>Módulo de Cursos</h2>
            <div class="sub-label">Cadastre os cursos que você ministra.</div>
            
            <div id="courses-list"></div>

            <button id="btn-show-course-form" class="btn-dashed">+ Adicionar curso</button>

            <div id="course-form-container" class="hidden">
                <div class="course-form-box">
                    <h3 id="form-course-title">Adicionar Novo Curso</h3>
                    
                    <label>Nome do Curso *</label>
                    <input type="text" id="c-name" class="course-input">
                    
                    <label style="margin-top:15px">Tipo * (Selecione todos que se aplicam)</label>
                    <div class="checkbox-group" id="c-type-group">
                        <label><input type="checkbox" value="Teórico"> Teórico</label>
                        <label><input type="checkbox" value="Prático"> Prático</label>
                        <label><input type="checkbox" value="Hands-on"> Hands-on</label>
                        <label><input type="checkbox" value="Curso Vip"> Curso Vip</label>
                        <label><input type="checkbox" value="Pós-graduação"> Pós-graduação</label>
                        <label><input type="checkbox" value="Imersão"> Imersão</label>
                        <label style="flex-wrap: wrap;">
                            <input type="checkbox" value="Outro" id="chk-ctype-other"> Outro 
                            <input type="text" id="c-type-other-text" placeholder="Qual?" class="hidden" style="margin-left: 10px; flex-grow: 1; padding: 5px;">
                        </label>
                    </div>

                    <label style="margin-top:15px">Em quais regiões costuma realizar? *</label>
                    <div class="sub-label">Liste cidades, estados, regiões e/ou países</div>
                    <input type="text" id="c-region" class="course-input">

                    <label style="margin-top:15px">Qual é a frequência? *</label>
                    <div class="radio-group" id="c-freq-group">
                        <label><input type="radio" name="c_freq" value="Datas fixas e definidas com antecedência"> Datas fixas e definidas com antecedência.</label>
                        <label><input type="radio" name="c_freq" value="De acordo com demanda"> De acordo com demanda.</label>
                    </div>

                    <label style="margin-top:15px">Qual a duração? *</label>
                    <div class="sub-label">Ex: “44h”, “5 finais de semana”, “1 semestre”</div>
                    <input type="text" id="c-duration" class="course-input">

                    <label style="margin-top:15px">Qual costuma ser a média de alunos que participam? *</label>
                    <input type="text" id="c-students" class="course-input">

                    <label style="margin-top:15px">Divulgação (Link)</label>
                    <div class="sub-label">Site, página, apresentação ou arte utilizada</div>
                    <input type="text" id="c-link-divulgacao" class="course-input" placeholder="https://...">

                    <label style="margin-top:15px">Conteúdo (Link)</label>
                    <div class="sub-label">Apresentação, resultados clínicos, fotos, materiais</div>
                    <input type="text" id="c-link-conteudo" class="course-input" placeholder="https://...">

                    <div class="error-msg" id="course-add-error" style="margin-bottom: 15px;">Preencha todos os campos obrigatórios (*).</div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-secondary" id="btn-cancel-course" style="width: auto;">Cancelar</button>
                        <button class="btn btn-action" id="btn-save-course" style="margin-top:0;">Salvar Curso</button>
                    </div>
                </div>
            </div>
            
            <div class="error-msg" id="course-list-error">Adicione pelo menos um curso para continuar</div>

            <div class="nav-buttons">
                <button class="btn btn-secondary btn-prev">Voltar</button>
                <button class="btn btn-primary btn-submit">Enviar Solicitação</button>
            </div>
        </div>

    </form>

    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Enviando seus dados...</p>
    </div>

    <div id="success-screen" class="hidden">
        <div class="success-icon">✓</div>
        <h2>Obrigado pelo cadastro!</h2>
        <p>Recebemos suas informações com sucesso.</p>
    </div>

</div>

<script>
    let ultimaAlturaEnviada = 0;

    // Função que calcula a altura e envia para o 'pai' (RD Station)
    function enviarAlturaParaOIframe() {
        // Mede o container de conteúdo, não o body inteiro
        const container = document.getElementById('app-container');
        if (!container) return;

        const alturaAtual = container.scrollHeight;
        
        // --- TRAVA DE SEGURANÇA ---
        // Só envia se a diferença for maior que 15px para evitar loops infinitos
        if (Math.abs(alturaAtual - ultimaAlturaEnviada) > 15) {
            ultimaAlturaEnviada = alturaAtual;
            // Envia mensagem para qualquer origem (*)
            window.parent.postMessage({ iframeHeight: alturaAtual }, '*');
        }
    }

    // 1. Enviar ao carregar
    window.addEventListener('load', () => setTimeout(enviarAlturaParaOIframe, 100));

    // 2. Enviar ao redimensionar a janela (com debounce leve)
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(enviarAlturaParaOIframe, 200);
    });

    // 3. Monitorar mudanças no DOM
    const observer = new MutationObserver((mutations) => {
        // Verifica se a mudança é relevante
        enviarAlturaParaOIframe();
    });
    
    // Observa o container principal em vez do body inteiro
    const appContainer = document.getElementById('app-container');
    if (appContainer) {
        observer.observe(appContainer, { 
            attributes: true, 
            childList: true, 
            subtree: true 
        });
    }
</script>

</body>
</html>
